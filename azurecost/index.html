<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Azure Cost Dashboard by Resource Group</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    h2 { color: #0078d4; }
    .uploader { margin: 20px 0; padding: 20px; border: 2px dashed #ccc; background: white; text-align: center; }
    .summary { margin: 20px 0; padding: 10px; background: #e7f3ff; border-left: 4px solid #0078d4; font-size: 16px; }
    table { width: 100%; background: white; }
  </style>
</head>
<body>
  <h2>Azure Cost Dashboard – Resource Group Wise</h2>

  <div class="uploader">
    <input type="file" id="csvFiles" multiple accept=".csv">
    <p>Select multiple CSV files to view combined cost data</p>
  </div>

  <div class="summary" id="costSummary">
    Total Cost: ₹0 | Total USD: $0
  </div>

  <table id="costTable" class="display">
    <thead>
      <tr>
        <th>Resource Group</th>
        <th>Subscription Name</th>
        <th>Cost</th>
        <th>Cost USD</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let allData = [];

    function parseCSV(file) {
      return new Promise((resolve, reject) => {
        Papa.parse(file, {
          header: true,
          skipEmptyLines: true,
          complete: results => resolve(results.data),
          error: err => reject(err)
        });
      });
    }

    $('#csvFiles').on('change', async function (e) {
      const files = Array.from(e.target.files);
      allData = [];

      for (const file of files) {
        const data = await parseCSV(file);
        allData.push(...data);
      }

      populateTable(allData);
      updateSummary(allData);
    });

    function populateTable(data) {
      const table = $('#costTable').DataTable();
      table.clear();

      data.forEach(row => {
        table.row.add([
          row.ResourceGroup || '',
          row.SubscriptionName || '',
          parseFloat(row.Cost || 0).toFixed(2),
          parseFloat(row.CostUSD || 0).toFixed(2)
        ]);
      });

      table.draw();
    }

    function updateSummary(data) {
      let totalINR = 0;
      let totalUSD = 0;

      data.forEach(row => {
        totalINR += parseFloat(row.Cost || 0);
        totalUSD += parseFloat(row.CostUSD || 0);
      });

      document.getElementById('costSummary').innerHTML = `
        <strong>Total Cost:</strong> ₹${totalINR.toFixed(2)} | 
        <strong>Total USD:</strong> $${totalUSD.toFixed(2)}
      `;
    }

    $(document).ready(function () {
      $('#costTable').DataTable();
    });
  </script>
</body>
</html>
